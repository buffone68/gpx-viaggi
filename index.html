<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <title>Namibia 2025 – GPX</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-gpx/1.7.0/gpx.min.js"></script>
  <style>
    html,body,#map{height:100%;margin:0}
    #map{position:relative; z-index:1;}
    .legend{position:absolute;top:60px;left:10px;background:#fff;padding:10px 12px;border-radius:8px;box-shadow:0 2px 7px rgba(0,0,0,.25);max-height:55%;overflow:auto;font:13px/1.35 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;z-index:9999}
    .legend b{display:block;margin-bottom:8px}
    .legend div{margin:3px 0}
    .swatch{display:inline-block;width:12px;height:12px;margin-right:8px;border-radius:3px;vertical-align:middle}
  </style>
</head>
<body>
<div id="map"></div>
<div class="legend" id="legend"><b>Namibia 2025 – Giorni</b></div>
<script>
  const files = [
    '2025-07-28-Giorno-01-Namibia.GPX',
    '2025-07-29-Giorno-02-Namibia.GPX',
    '2025-07-30-Giorno-03-Namibia.GPX',
    '2025-07-31-Giorno-04-Namibia.GPX',
    '2025-08-01-Giorno-05-Namibia.GPX',
    '2025-08-02-Giorno-06-Namibia.GPX',
    '2025-08-03-Giorno-07-Namibia.GPX',
    '2025-08-04-Giorno-08-Namibia.GPX',
    '2025-08-05-Giorno-09-Namibia.GPX',
    '2025-08-06-Giorno-10-Namibia.GPX',
    '2025-08-07-Giorno-11-Namibia.GPX',
    '2025-08-08-Giorno-12-Namibia.GPX',
    '2025-08-09-Giorno-13-Namibia.GPX',
    '2025-08-10-Giorno-14-Namibia.GPX'
  ].map(f => `https://raw.githubusercontent.com/buffone68/gpx-viaggi/refs/heads/main/2025.07-Namibia/${f}`);

  const colors = [
    '#e41a1c','#377eb8','#4daf4a','#984ea3',
    '#ff7f00','#a65628','#f781bf','#999999',
    '#1b9e77','#d95f02','#7570b3','#e7298a',
    '#66a61e','#e6ab02'
  ];

  const map = L.map('map').setView([-22.56, 17.08], 5);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '© OpenStreetMap contributors'
  }).addTo(map);

  const overall = L.latLngBounds([]);
  const legend = document.getElementById('legend');
  let remaining = files.length;

  // --- Crea la legenda subito in ordine fisso ---
  const legendItems = [];
  files.forEach((url, idx) => {
    const color = colors[idx % colors.length];
    const name = url.split('/').pop().replace('.GPX','');
    const item = document.createElement('div');
    item.innerHTML = '<span class="swatch" style="background:'+color+'"></span>' + name;
    legend.appendChild(item);
    legendItems.push({url, color});
  });

  // --- Poi carica i GPX in parallelo ---
  legendItems.forEach(({url, color}) => {
    new L.GPX(url, {
      async: true,
      polyline_options: { color: color, weight: 4, opacity: 0.95 },
      marker_options: { startIconUrl: null, endIconUrl: null, shadowUrl: null }
    })
    .on('loaded', function(e) {
      overall.extend(e.target.getBounds());
      remaining -= 1;
      if (remaining === 0) {
        map.fitBounds(overall, { padding: [20,20] });
      }
    })
    .addTo(map);
  });
</script>
</body>
</html>
